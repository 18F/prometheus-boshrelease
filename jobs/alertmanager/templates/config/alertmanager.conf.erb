<% if_p("alertmanager.notifications") do |notifications| %>
<% notifications.each do |notification| %>
notification_config {
  name: "<%= notification["name"] || "notification#{index}" %>"
<% if notification.has_key?("pagerduty") && ! notification["pagerduty"].empty? %>
  pagerduty_config {
    service_key: "<%= notification["pagerduty"]["service_key"] %>"
  }
<% end %>
<% if notification.has_key?("email") %>
  email_config {
    email: "<%= notification["email"] %>"
  }
<% end %>
<% if notification.has_key?("pushover") && ! notification["pushover"].empty? %>
  pushover_config {
    user_key: "<%= notification["pushover"]["user_key"] %>"
    token:    "<%= notification["pushover"]["token"] %>"
  }
<% end %>
<% if notification.has_key?("hipchat") && ! notification["hipchat"].empty? %>
  hipchat_config {
    room_id:    <%= notification["hipchat"]["room_id"] || 0 %>
    auth_token: "<%= notification["hipchat"]["auth_token"] %>"
  }
<% end %>
}
<% end %>
<% end %>
<% if_p("alertmanager.aggregations") do |aggregations| %>
<% aggregations.each do |aggregation| %>
aggregation_rule {
  filter {
<%
    name_re  = "."
    value_re = "."
    if aggregation.has_key?("match")
      name_re = aggregation["match"]["name_re"] || "."
      value_re = aggregation["match"]["value_re"] || "."
    end
%>
    name_re:  "<%= name_re %>"
    value_re: "<%= value_re %>"
  }
  repeat_rate_seconds: <%= aggregation["interval"] || 600 %>
  notification_config_name: "<%= aggregation["notification_name"] %>"
}
<% end %>
<% end %>
